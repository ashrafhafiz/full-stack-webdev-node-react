{"version":3,"sources":["../../src/routes/apiRoutes.js"],"names":["router","express","Router","stripe","process","env","STRIPE_SECRET_KEY","get","req","res","logout","redirect","send","user","post","requireLogin","charges","create","amount","currency","source","body","id","description","charge","credits","save"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;AACA,IAAMA,MAAM,GAAGC,oBAAQC,MAAR,EAAf;;AACA,IAAMC,MAAM,GAAG,wBAAOC,OAAO,CAACC,GAAR,CAAYC,iBAAnB,CAAf;AAEAN,MAAM,CAACO,GAAP,CAAW,aAAX,EAA0B,UAACC,GAAD,EAAMC,GAAN,EAAc;AACtCD,EAAAA,GAAG,CAACE,MAAJ;AACAD,EAAAA,GAAG,CAACE,QAAJ,CAAa,GAAb;AACD,CAHD;AAKAX,MAAM,CAACO,GAAP,CAAW,kBAAX,EAA+B,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3C;AACA;AACAA,EAAAA,GAAG,CAACG,IAAJ,CAASJ,GAAG,CAACK,IAAb;AACD,CAJD;AAMAb,MAAM,CAACc,IAAP,CAAY,aAAZ,EAA2BC,wBAA3B;AAAA,qEAAyC,iBAAOP,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAkBlBN,MAAM,CAACa,OAAP,CAAeC,MAAf,CAAsB;AACzCC,cAAAA,MAAM,EAAE,GADiC;AAEzCC,cAAAA,QAAQ,EAAE,KAF+B;AAGzCC,cAAAA,MAAM,EAAEZ,GAAG,CAACa,IAAJ,CAASC,EAHwB;AAIzCC,cAAAA,WAAW,EAAE;AAJ4B,aAAtB,CAlBkB;;AAAA;AAkBjCC,YAAAA,MAlBiC;AAyBvChB,YAAAA,GAAG,CAACK,IAAJ,CAASY,OAAT,IAAoB,CAApB;AAzBuC;AAAA,mBA0BpBjB,GAAG,CAACK,IAAJ,CAASa,IAAT,EA1BoB;;AAAA;AA0BjCb,YAAAA,IA1BiC;AA2BvCJ,YAAAA,GAAG,CAACG,IAAJ,CAASC,IAAT;;AA3BuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAzC;;AAAA;AAAA;AAAA;AAAA;eA8Beb,M","sourcesContent":["import \"dotenv/config\";\r\nimport requireLogin from \"../middlewares/requireLogin\";\r\nimport express from \"express\";\r\nimport Stripe from \"stripe\";\r\nconst router = express.Router();\r\nconst stripe = Stripe(process.env.STRIPE_SECRET_KEY);\r\n\r\nrouter.get(\"/api/logout\", (req, res) => {\r\n  req.logout();\r\n  res.redirect(\"/\");\r\n});\r\n\r\nrouter.get(\"/api/currentuser\", (req, res) => {\r\n  // console.log(req);\r\n  // res.send(req.session);\r\n  res.send(req.user);\r\n});\r\n\r\nrouter.post(\"/api/stripe\", requireLogin, async (req, res) => {\r\n  //   console.log(req.body);\r\n\r\n  // `source` is obtained with Stripe.js; see https://stripe.com/docs/payments/accept-a-payment-charges#web-create-token\r\n  //   stripe.charges.create(\r\n  //     {\r\n  //       amount: 500,\r\n  //       currency: \"usd\",\r\n  //       source: req.body.id,\r\n  //       description: \"$5 for 5 Credits\",\r\n  //     },\r\n  //     function (err, charge) {\r\n  //       // asynchronously called to update users' credits\r\n  //       console.log(charge);\r\n  //       req.user.credits += 5;\r\n  //       req.user.save().then((user) => res.send(user));\r\n  //     }\r\n  //   );\r\n  const charge = await stripe.charges.create({\r\n    amount: 500,\r\n    currency: \"usd\",\r\n    source: req.body.id,\r\n    description: \"$5 for 5 Credits\",\r\n  });\r\n\r\n  req.user.credits += 5;\r\n  const user = await req.user.save();\r\n  res.send(user);\r\n});\r\n\r\nexport default router;\r\n"],"file":"apiRoutes.js"}