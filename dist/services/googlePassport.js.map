{"version":3,"sources":["../../src/services/googlePassport.js"],"names":["GOOGLE_CLIENT_ID","process","env","GOOGLE_CLIENT_SECRET","passport","serializeUser","user","cb","id","deserializeUser","User","findById","use","GoogleStrategy","Strategy","clientID","clientSecret","callbackURL","proxy","accessToken","refreshToken","profile","findOne","googleId","existingUser","name","displayName","email","emails","value","save","newUser"],"mappings":";;AAAA;;AACA;;AACA;;AACA;;;;;;;;AAEA;AACA;AACA;AACA;AACA,IAAMA,gBAAgB,GAAGC,OAAO,CAACC,GAAR,CAAYF,gBAArC;AACA,IAAMG,oBAAoB,GAAGF,OAAO,CAACC,GAAR,CAAYC,oBAAzC;;AAEAC,qBAASC,aAAT,CAAuB,UAACC,IAAD,EAAOC,EAAP,EAAc;AACnCA,EAAAA,EAAE,CAAC,IAAD,EAAOD,IAAI,CAACE,EAAZ,CAAF;AACD,CAFD;;AAIAJ,qBAASK,eAAT;AAAA,qEAAyB,iBAAOD,EAAP,EAAWD,EAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACJG,sBAAKC,QAAL,CAAcH,EAAd,CADI;;AAAA;AACjBF,YAAAA,IADiB;AAEvBC,YAAAA,EAAE,CAAC,IAAD,EAAOD,IAAP,CAAF;;AAFuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAzB;;AAAA;AAAA;AAAA;AAAA;;AAKAF,qBAASQ,GAAT,CACE,IAAIC,gCAAeC,QAAnB,CACE;AACEC,EAAAA,QAAQ,EAAEf,gBADZ;AAEEgB,EAAAA,YAAY,EAAEb,oBAFhB;AAGEc,EAAAA,WAAW,EAAE,uBAHf;AAIEC,EAAAA,KAAK,EAAE;AAJT,CADF;AAAA,sEAOE,kBAAOC,WAAP,EAAoBC,YAApB,EAAkCC,OAAlC,EAA2Cd,EAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAC6BG,sBAAKY,OAAL,CAAa;AAAEC,cAAAA,QAAQ,EAAEF,OAAO,CAACb;AAApB,aAAb,CAD7B;;AAAA;AACQgB,YAAAA,YADR;;AAAA,iBAEMA,YAFN;AAAA;AAAA;AAAA;;AAAA,8CAE2BjB,EAAE,CAAC,IAAD,EAAOiB,YAAP,CAF7B;;AAAA;AAAA;AAAA,mBAGwB,IAAId,qBAAJ,CAAS;AAC7Ba,cAAAA,QAAQ,EAAEF,OAAO,CAACb,EADW;AAE7BiB,cAAAA,IAAI,EAAEJ,OAAO,CAACK,WAFe;AAG7BC,cAAAA,KAAK,EAAEN,OAAO,CAACO,MAAR,CAAe,CAAf,EAAkBC;AAHI,aAAT,EAInBC,IAJmB,EAHxB;;AAAA;AAGQC,YAAAA,OAHR;AAQExB,YAAAA,EAAE,CAAC,IAAD,EAAOwB,OAAP,CAAF,CARF,CAUE;AACA;AACA;;AAZF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAPF;;AAAA;AAAA;AAAA;AAAA,IADF","sourcesContent":["import passport from \"passport\";\r\nimport GoogleStrategy from \"passport-google-oauth20\";\r\nimport \"dotenv/config\";\r\nimport User from \"../models/userModel\";\r\n\r\n//\r\n// G O O G L E   A U T H E N T I C A T I O N\r\n// Code have be refactored to ES7 async/await\r\n//\r\nconst GOOGLE_CLIENT_ID = process.env.GOOGLE_CLIENT_ID;\r\nconst GOOGLE_CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;\r\n\r\npassport.serializeUser((user, cb) => {\r\n  cb(null, user.id);\r\n});\r\n\r\npassport.deserializeUser(async (id, cb) => {\r\n  const user = await User.findById(id);\r\n  cb(null, user);\r\n});\r\n\r\npassport.use(\r\n  new GoogleStrategy.Strategy(\r\n    {\r\n      clientID: GOOGLE_CLIENT_ID,\r\n      clientSecret: GOOGLE_CLIENT_SECRET,\r\n      callbackURL: \"/auth/google/callback\",\r\n      proxy: true,\r\n    },\r\n    async (accessToken, refreshToken, profile, cb) => {\r\n      const existingUser = await User.findOne({ googleId: profile.id });\r\n      if (existingUser) return cb(null, existingUser);\r\n      const newUser = await new User({\r\n        googleId: profile.id,\r\n        name: profile.displayName,\r\n        email: profile.emails[0].value,\r\n      }).save();\r\n      cb(null, newUser);\r\n\r\n      // User.findOrCreate({ googleId: profile.id }, (err, user) => {\r\n      //   return cb(err, user);\r\n      // });\r\n    }\r\n  )\r\n);\r\n"],"file":"googlePassport.js"}